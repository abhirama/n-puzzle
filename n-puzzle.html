<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

		<style type="text/css">
			table { 
				margin-left: auto;
				margin-right: auto;
				text-align: center;
			}

			.cell {
				background-color: red;
				cursor: pointer;
			}
		</style>

		<script type="text/JavaScript" src="jquery-1.4.3.js"></script> 
		<script type="text/javascript">
			$(document).ready(function(){
				function createTable(rows, columns) {
					//using dom appending to create the table as it is more readable than string munging. 
					//Not the most efficient way but for a small app like this it does not matter.
					$('#mainContainer').append('<table border="1" cell-padding="1" cell-spacing="1" id="board"></table>');
					for (var row = 0; row < rows; ++row) {
						$('#board').append('<tr></tr>');
						for (var column = 0; column < columns; ++column) {
							var id = getCellId(row, column);
							$('#board tr:last').append('<td id=' + id + '></td>');
							$('#' + id).data("row", row);
							$('#' + id).data("column", column);
						}
					}
				}

				function getNumberArray(rows, columns) {
					//generate an array that holds all the number applicable for the board
					var totalCount = rows * columns;
					var numbers = [];
					for (var no = 1; no < totalCount; ++no) {
						numbers.push(no);		
					}
					return numbers;
				}

				//using Fisher Yates algorithm
				function shuffleNumberArray(numbers) {
					var totalCount = numbers.length;
					for (var index = 0; index < totalCount; ++index) {
						var shuffleIndex = Math.floor(Math.random() * (totalCount - 1));
						swap(index, shuffleIndex, numbers);
					}
				}

				function swap(firstIndex, secondIndex, arrayy) {
					var temp = arrayy[firstIndex];
					arrayy[firstIndex] = arrayy[secondIndex];
					arrayy[secondIndex] = temp;
				}

				function assignNumbersToBoard(numbers) {
					var index = 0;
					$('#board td').each(function(){
						if (index == numbers.length) {
							return;
						}

						$(this).text(numbers[index]);
						$(this).addClass('cell');
						index = index + 1;
					});
				}

				function getNumber(cell) {
					return cell.text();
				}

				function isEmptyCell(cell) {
					var numberr = getNumber(cell);
					if (numberr == 'undefined' || numberr == '') {
						return true;
					}
					return false;
				}

				function isValidClick(cell) {
					var row = cell.data('row');
					var column = cell.data('column');

					//blindly check the four cells bounding this cell for empty space. If found, valid click. Else invalid

					//check to left
					var leftColumn = column - 1;
					var validClick = validClickHelper(row, leftColumn);

					if (validClick) {
						return true;
					}

					//check right
					var rightColumn = column + 1;
					validClick = validClickHelper(row, rightColumn);

					if (validClick) {
						return true;
					}

					//check top
					var topRow = row - 1;
					validClick = validClickHelper(topRow, column);

					if (validClick) {
						return true;
					}

					//check below 
					var belowRow = row + 1;
					validClick = validClickHelper(belowRow, column);

					if (validClick) {
						return true;
					}

					return false;
				}

				function validClickHelper(row, column) {
					if (isInsideBoardBound(row, column)) {
						var cellId = getCellId(row, column);
						if (isEmptyCell($('#' + cellId))) {
							return true;
						}
					}
					return false;
				}

				function isInsideBoardBound(row, column) {
					return row > 0 && column > 0 && row < INITIAL_ROWS && column < INITIAL_COLUMNS;
				}

				function getCellId(row, column) {
					return 'cell' + row + '' + column;
				}

				//inline - begin
				var INITIAL_ROWS = 4;
				var INITIAL_COLUMNS = 4;
				createTable(INITIAL_ROWS, INITIAL_COLUMNS);
				var numbers = getNumberArray(INITIAL_ROWS, INITIAL_COLUMNS);
				shuffleNumberArray(numbers);
				assignNumbersToBoard(numbers);

				$('.cell').bind('click', function(){
					if (isValidClick($(this))) {
						alert('Valid click');
					} else {
						alert('Invalid click');
					}
				});
				//inline - end 
			});
		</script>
	</head>
	<body>
		<div id="mainContainer">
		</div>
	</body>
</html>

